{"version":3,"sources":["../build/index.js","../build/webpart.js"],"names":[],"mappings":"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","file":"gd-sp-webpart.js","sourcesContent":["\"use strict\";\r\nfunction __export(m) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n__export(require(\"./webpart\"));\r\nvar webpart_1 = require(\"./webpart\");\r\n// Create the global variable\r\nvar $REST = window[\"$REST\"] || {};\r\n$REST.WebPart = webpart_1.WebPart;\r\n//# sourceMappingURL=index.js.map","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n/**\r\n * Web Part\r\n */\r\nvar WebPart = /** @class */ (function () {\r\n    /**\r\n     * Constructor\r\n     * @param props - The webpart properties.\r\n     */\r\n    function WebPart(props) {\r\n        var _this = this;\r\n        this._props = null;\r\n        this._wp = null;\r\n        /**\r\n         * Method to add the help link to a script part editor.\r\n         * @wpId - The webpart id.\r\n         */\r\n        this.addHelpLink = function () {\r\n            // Ensure the help properties exist\r\n            if (_this._props.helpProps) {\r\n                // Get the webpart's \"Snippet\"\r\n                var link = document.querySelector(\"div[webpartid='\" + _this._wp.wpId + \"'] a[title='Edit Snippet']\");\r\n                if (link) {\r\n                    // Create the help link\r\n                    var helpLink = document.createElement(\"a\");\r\n                    helpLink.href = _this._props.helpProps.url || \"#\";\r\n                    helpLink.style.paddingLeft = \"10px\";\r\n                    helpLink.setAttribute(\"role\", \"button\");\r\n                    helpLink.title = _this._props.helpProps.title || \"Help\";\r\n                    helpLink.innerHTML = \"<span class='ms-metadata'>\" + helpLink.title + \"</span>\";\r\n                    helpLink.target = \"_blank\";\r\n                    // Append the link\r\n                    link.parentElement.appendChild(helpLink);\r\n                }\r\n            }\r\n        };\r\n        /**\r\n         * Method to get the webpart information\r\n         */\r\n        this.getWebPartInfo = function () {\r\n            var targetInfo = {\r\n                cfg: null,\r\n                el: null,\r\n                wpId: null\r\n            };\r\n            // Ensure the element id exists\r\n            if (_this._props.elementId) {\r\n                // Get the webpart elements\r\n                var elements = document.querySelectorAll(\"#\" + _this._props.elementId);\r\n                for (var i = 0; i < elements.length; i++) {\r\n                    var elWebPart = elements[i];\r\n                    // See if we have already configured this element\r\n                    if (elWebPart.getAttribute(\"data-isConfigured\")) {\r\n                        continue;\r\n                    }\r\n                    // Get the webpart id\r\n                    var wpId = _this.getWebPartId(elWebPart);\r\n                    if (wpId) {\r\n                        // See if the configuration element exists\r\n                        var elCfg = _this._props.cfgElementId ? elWebPart.parentElement.querySelector(\"#\" + _this._props.cfgElementId) : null;\r\n                        if (elCfg) {\r\n                            try {\r\n                                // Parse the configuration\r\n                                var cfg = JSON.parse(elCfg.innerText.trim());\r\n                                // See if the webaprt id exists\r\n                                if (cfg.WebPartId) {\r\n                                    // See if it's for this webpart\r\n                                    if (cfg.WebPartId == wpId) {\r\n                                        // Set the target information\r\n                                        targetInfo = {\r\n                                            cfg: cfg,\r\n                                            el: elWebPart,\r\n                                            wpId: wpId\r\n                                        };\r\n                                        break;\r\n                                    }\r\n                                }\r\n                                else {\r\n                                    // Set the target information\r\n                                    targetInfo = {\r\n                                        cfg: {\r\n                                            WebPartId: wpId\r\n                                        },\r\n                                        el: elWebPart,\r\n                                        wpId: wpId\r\n                                    };\r\n                                    break;\r\n                                }\r\n                            }\r\n                            catch (ex) {\r\n                                // Set the target information\r\n                                targetInfo = {\r\n                                    cfg: {\r\n                                        WebPartId: wpId\r\n                                    },\r\n                                    el: elWebPart,\r\n                                    wpId: wpId\r\n                                };\r\n                                // Log\r\n                                console.log(\"[sp-webpart] Error parsing the configuration for element '\" + _this._props.cfgElementId + \"'.\");\r\n                            }\r\n                            // Break from the loop\r\n                            break;\r\n                        }\r\n                        else {\r\n                            // Set the target information\r\n                            targetInfo = {\r\n                                cfg: {\r\n                                    WebPartId: wpId\r\n                                },\r\n                                el: elWebPart,\r\n                                wpId: wpId\r\n                            };\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n                // Ensure elements were found\r\n                if (elements.length == 0) {\r\n                    // Log\r\n                    console.log(\"[sp-webpart] Error - Unable to find elements with id '\" + _this._props.elementId + \"'.\");\r\n                }\r\n            }\r\n            else {\r\n                // Log\r\n                console.log(\"[sp-webpart] The target element id is not defined.\");\r\n            }\r\n            // Ensure the target element exists\r\n            if (targetInfo.el) {\r\n                // Set the configuration flag\r\n                targetInfo.el.setAttribute(\"data-isConfigured\", \"true\");\r\n            }\r\n            // Return the target information\r\n            return targetInfo;\r\n        };\r\n        /**\r\n         * Method to render the webpart\r\n         */\r\n        this.render = function () {\r\n            var element = null;\r\n            // Get the webpart information\r\n            _this._wp = _this.getWebPartInfo();\r\n            if (_this._wp == null || _this._wp.el == null) {\r\n                // Log\r\n                console.log(\"[sp-webpart] The target webpart element '\" + _this._props.elementId + \"' was not found.\");\r\n                return;\r\n            }\r\n            // See if the page is being edited\r\n            var returnVal = null;\r\n            if (_this.isEditMode()) {\r\n                // Add the help link\r\n                _this.addHelpLink();\r\n                // Call the render event\r\n                if (_this._props.onRenderEditElement) {\r\n                    // Execute the render edit event\r\n                    returnVal = _this._props.onRenderEditElement(_this._wp);\r\n                }\r\n            }\r\n            else {\r\n                // See if the configuration is defined, but has no value\r\n                if (_this._wp.cfg || (_this._props.cfgElementId || \"\").length == 0) {\r\n                    // Execute the render edit event\r\n                    returnVal = _this._props.onRenderDisplay(_this._wp);\r\n                }\r\n                else {\r\n                    // Render a message\r\n                    _this._wp.el.innerHTML = '<h3>Please edit the page and configure the webpart.</h3>';\r\n                }\r\n            }\r\n            // See if a promise was returned\r\n            if (returnVal && returnVal.then) {\r\n                // Wait for the request to complete\r\n                returnVal.then(function () {\r\n                    var args = [];\r\n                    for (var _i = 0; _i < arguments.length; _i++) {\r\n                        args[_i] = arguments[_i];\r\n                    }\r\n                    // Execute the post render event\r\n                    _this._props.onPostRender ? _this._props.onPostRender(_this._wp) : null;\r\n                });\r\n            }\r\n            else {\r\n                // Execute the post render event\r\n                _this._props.onPostRender ? _this._props.onPostRender(_this._wp) : null;\r\n            }\r\n        };\r\n        // Set the properties\r\n        this._props = props || {};\r\n        // Add a load event\r\n        window.addEventListener(\"load\", function () {\r\n            // Render the component\r\n            _this.render();\r\n        });\r\n    }\r\n    /**\r\n     * Method to get the webpart\r\n     */\r\n    WebPart.prototype.getWebPart = function (wpId) {\r\n        // Return a promise\r\n        return new Promise(function (resolve, reject) {\r\n            // Get the current context\r\n            var context = SP.ClientContext.get_current();\r\n            // Get the webpart from the current page\r\n            var page = context.get_web().getFileByServerRelativeUrl(_spPageContextInfo.serverRequestPath);\r\n            var wpMgr = page.getLimitedWebPartManager(SP.WebParts.PersonalizationScope.shared);\r\n            var wpDef = wpMgr.get_webParts().getById(wpId);\r\n            var wp = wpDef.get_webPart();\r\n            context.load(wp, \"Properties\");\r\n            // Execute the request\r\n            context.executeQueryAsync(\r\n            // Success\r\n            function () {\r\n                // Resolve the promise\r\n                resolve({\r\n                    Context: context,\r\n                    Properties: wp.get_properties(),\r\n                    WebPart: wp,\r\n                    WebPartDefinition: wpDef,\r\n                    WebPartId: wp.get_id()\r\n                });\r\n            }, \r\n            // Error\r\n            function () {\r\n                var args = [];\r\n                for (var _i = 0; _i < arguments.length; _i++) {\r\n                    args[_i] = arguments[_i];\r\n                }\r\n                // Reject the promise\r\n                reject(args[1] ? args[1].get_message() : \"\");\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Method to get the webpart id for a specified element\r\n     * @param el - The target element.\r\n     */\r\n    WebPart.prototype.getWebPartId = function (el) {\r\n        // Loop until we find the webpart id\r\n        while (el) {\r\n            // See if this element contains the webpart id\r\n            var wpId = el.getAttribute(\"webpartid\");\r\n            if (wpId) {\r\n                // Return the webpart id\r\n                return wpId;\r\n            }\r\n            // Check the parent\r\n            el = el.parentElement;\r\n        }\r\n        // Unable to detect\r\n        return \"\";\r\n    };\r\n    /**\r\n     * Method to detect if a page is being edited\r\n     */\r\n    WebPart.prototype.isEditMode = function () {\r\n        var formName = MSOWebPartPageFormName ? MSOWebPartPageFormName : \"\";\r\n        // Get the form\r\n        var form = document.forms[MSOWebPartPageFormName];\r\n        if (form) {\r\n            // Get the wiki page mode\r\n            var wikiPageMode = form._wikiPageMode ? form._wikiPageMode.value : null;\r\n            // Get the webpart page mode\r\n            var wpPageMode = form.MSOLayout_InDesignMode ? form.MSOLayout_InDesignMode.value : null;\r\n            // Determine if the page is being edited\r\n            return wikiPageMode == \"Edit\" || wpPageMode == \"1\";\r\n        }\r\n        // Unable to determine\r\n        return false;\r\n    };\r\n    return WebPart;\r\n}());\r\nexports.WebPart = WebPart;\r\n//# sourceMappingURL=webpart.js.map"]}